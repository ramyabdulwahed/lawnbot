<?xml version="1.0"?>
<robot name="my_robot">

<gazebo>
  <static>false</static>
</gazebo>

    <material name="grey">
        <color rgba= "0.7 0.7 0.7 1"/>
    </material>

    <material name="green">
        <color rgba="0 0.6 0 1"/>
    </material>

    <material name="white">
        <color rgba="1 1 1 1" />
    </material>
        

    <link name="base_footprint"/>

    <joint name="base_base_footprint" type="fixed">
        <parent link="base_footprint"/>
        <child link="base_link"/>
        <origin xyz="0 0 0.1" rpy="0 0 0"/> 
    </joint>

    <link name="base_link">

        <visual>
            <geometry>
                <box size="0.6 0.4 0.2"/>
            </geometry>
            <origin xyz="0 0 0.1" rpy="0 0 0"/>
            <material name="green"/>
        </visual>
        <collision>
            <geometry>
                <box size="0.6 0.4 0.2"/>
            </geometry>
                            <origin xyz="0 0 0.1" rpy="0 0 0"/>

        </collision>

        <inertial>
            <mass value="5.0"/>
            <inertia ixx="0.1" ixy="0.0" ixz="0.0"
               iyy="0.1" iyz="0.0"
               izz="0.1"/>
        </inertial>

    </link>

    <link name="lidar">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="white"/> 
        </visual>
        <collision>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
        </collision>


        <inertial>
  
        <mass value="0.1"/>
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                iyy="0.0001" iyz="0.0"
                izz="0.0001"/>
        </inertial>

        <gazebo>
        <plugin name="gazebo_ros_laser_controller" filename="libgazebo_ros_ray_sensor.so">
            <ros>
            <namespace>/</namespace>
            </ros>
            <always_on>true</always_on>
            <update_rate>20.0</update_rate>
            <ray> 
            <scan>
                <horizontal>
                <samples>720</samples>        
                <resolution>1.0</resolution>
                <min_angle>-1.5708</min_angle> 
                <max_angle>1.5708</max_angle>  
                </horizontal>
            </scan>
            <range> 
                <min>0.1</min>
                <max>10.0</max>
                <resolution>0.01</resolution>
            </range>
            <noise>
                <type>gaussian</type>
                <mean>0.0</mean>
                <stddev>0.01</stddev>
            </noise>
            </ray>
            <topicName>scan</topicName> 
            <frameName>lidar</frameName> 
        </plugin>
        </gazebo>



    </link>

    <joint name="base_lidar_joint" type="fixed">
        <parent link ="base_link"/>
        <child link="lidar" />
        <origin xyz="0 0 0.225" rpy="0 0 0"/> 
    </joint>



    <link name="left_wheel">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/> 
            <material name="grey"/>
        </visual>

                <collision>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>

             <surface>
                <friction>
                <ode>
                    <mu>1.0</mu>
                    <mu2>1.0</mu2>
                </ode>
                </friction>
                <contact>
                <ode/>
                </contact>
            </surface>
        </collision>

        <inertial>
         <mass value="1.0"/>
          <inertia ixx="0.001" ixy="0.0" ixz="0.0"
               iyy="0.001" iyz="0.0"
               izz="0.001"/>

        </inertial>
    </link>


    <joint name="left_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="left_wheel"/>
        <origin xyz="-0.15 0.225 0" rpy="0 0 0"/> 
        <axis xyz="0 1 0"/> 
                <dynamics damping="1.0" friction="0.0"/>

    </joint>


    <link name="right_wheel">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/> 
            <material name="grey"/>
        </visual>
                        <collision>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/> 

             <surface>
                <friction>
                <ode>
                    <mu>1.0</mu>
                    <mu2>1.0</mu2>
                </ode>
                </friction>
                <contact>
                <ode/>
                </contact>
            </surface>
        </collision>

        <inertial>
         <mass value="1.0"/>
          <inertia ixx="0.001" ixy="0.0" ixz="0.0"
               iyy="0.001" iyz="0.0"
               izz="0.001"/>

        </inertial>
    </link>


    <joint name="right_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="right_wheel"/>
        <origin xyz="-0.15 -0.225 0" rpy="0 0 0"/> 
        
        <axis xyz="0 1 0"/> 
       <dynamics damping="1.0" friction="0.0"/>

    </joint>


    <link name="caster_wheel">
        <visual>
            <geometry>
                <sphere radius="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="grey"/>
        </visual>
    </link>


    <joint name="caster_wheel_joint" type="fixed">
        <parent link="base_link"/>
        <child link="caster_wheel"/>
        <origin xyz="0.2 0 -0.05" rpy="0 0 0"/> 
    </joint>


    <ros2_control name="GazeboSystem" type="system">
  <hardware>
    <plugin>gazebo_ros2_control/GazeboSystem</plugin>
  </hardware>

  <joint name="left_wheel_joint">
    <command_interface name="velocity"/>
    <state_interface name="velocity"/>
  </joint>

  <joint name="right_wheel_joint">
    <command_interface name="velocity"/>
    <state_interface name="velocity"/>
  </joint>
</ros2_control>


<gazebo reference="base_link">
  <material>Gazebo/Black</material>
</gazebo>

<gazebo reference="left_wheel">
  <material>Gazebo/Grey</material>
</gazebo>

<gazebo reference="right_wheel">
  <material>Gazebo/Grey</material>
</gazebo>

<gazebo reference="lidar">
  <material>Gazebo/Blue</material>
</gazebo>


<gazebo>
  <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so">
    <parameters>$(find main_logic_controller)/config/my_controllers.yaml</parameters>
   </plugin>
</gazebo>

</robot>